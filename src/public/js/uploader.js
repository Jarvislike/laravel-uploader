!function(e){function t(i){if(r[i])return r[i].exports;var o=r[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,t,r){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,r){"use strict";var i=function(e,t){"undefined"!=typeof window.uploader_options&&(t=t||{selectors:{}},this.selectors=Object.assign({picker:"file-uploader-picker",items:"file-uploader-items",item:"file-uploader-item",delete_btn:"file-uploader-delete",error:"file-uploader-error",progress_bar:"file-uploader-progress-bar"},t.selectors),this.container=document.querySelector(e),this.maxItems=this.container.dataset.maxItems||999,this.multiple=this.container.hasAttribute("multiple"),this.itemsContainer=this.container.querySelector("."+this.selectors.items),this.picker=this.createPicker(),this.formName=(t.form_name||this.container.dataset.formName||"images")+(this.multiple?"[]":""),this.itemTemplate=t.item_template||this.container.dataset.itemTemplate||'<img src="{URL}" />',this.assetBase=t.assetBase||this.container.dataset.assetBase||window.location.origin,this.pluploadUploader=this.createPluploadUploader(t))};i.prototype.init=function(){this.createPresentItems(),this.pluploadUploader.init()},i.prototype.createPresentItems=function(){var e=this,t=JSON.parse(this.container.dataset.items||"[]");t.forEach(function(t){e.appendItemToContainer(e.createFileItem({id:"o_"+Math.random().toString(36).substring(7)},e.renderItemContent({url:t})))})},i.prototype.createFileItem=function(e,t){var r=document.createElement("div");return r.id=e.id,r.setAttribute("class",this.selectors.item),r.insertAdjacentHTML("beforeEnd",'<a class="'+this.selectors.delete_btn+'" title="删除">&times;</a>'),r.insertAdjacentHTML("beforeEnd",'<div class="'+this.selectors.progress_bar+'"><span></span></div>'),t&&t.toString().length&&r.insertAdjacentHTML("beforeEnd",t.toString()),this.attachItemEventListeners(r)},i.prototype.renderItemContent=function(e){var t=this.itemTemplate;Object.keys(e).forEach(function(r){t=t.replace(new RegExp("{"+r.toUpperCase()+"}","g"),e[r])});var r=e.relative_url||e.url.replace(this.assetBase.replace(/\/$/,"")+"/","");return t+='<input type="hidden" name="'+this.formName+'" value="'+r+'" />'},i.prototype.appendItemToContainer=function(e){this.checkReachMaxItemsLimit();var t=this.itemsContainer.querySelector("."+this.selectors.picker)||null;return this.itemsContainer.insertBefore(e,t),this.checkReachMaxItemsLimit()},i.prototype.removeItemFromContainer=function(e){return this.itemsContainer.removeChild(e),this.checkReachMaxItemsLimit()},i.prototype.getFileItem=function(e){return this.itemsContainer.querySelector("#"+e.id)},i.prototype.checkReachMaxItemsLimit=function(){var e=this.getItemsCount()>=this.maxItems;return this.picker.style.display=e?"none":"inline-block",e},i.prototype.showItemProgress=function(e){var t=this.getFileItem(e).querySelector("."+this.selectors.progress_bar);t.style.display="block",t.querySelector("span").style.width=e.percent+"%"},i.prototype.showItemError=function(e){this.getFileItem(e.file).querySelector("."+this.selectors.progress_bar).display="none";var t=document.createElement("div");t.setAttribute("class",this.selectors.error),t.innerHTML="Error #"+e.code+": "+e.message,this.appendItemToContainer(t)},i.prototype.togglePicker=function(){"none"!=this.picker.style.display?this.picker.style.display="block":this.picker.style.display="none"},i.prototype.getItemsCount=function(){return this.itemsContainer.querySelectorAll("."+this.selectors.item).length},i.prototype.attachItemEventListeners=function(e){var t=this;return e.querySelector("."+this.selectors.delete_btn).addEventListener("click",function(){e.remove(),t.checkReachMaxItemsLimit()}),e},i.prototype.createPicker=function(){var e=this.container.querySelector("."+this.selectors.picker),t=document.createElement("div");return e.style.position="relative",t.style.position="absolute",t.style.top=t.style.bottom=t.style.left=t.style.right=0,e.appendChild(t),t},i.prototype.createPluploadUploader=function(e){var t=Object.assign(window.uploader_options,{form_name:this.formName,browse_button:this.picker,filters:{max_file_size:this.container.dataset.maxFileSize||"2mb",mime_types:[{title:this.container.dataset.title||"Image files",extensions:this.container.dataset.extensions||"jpg,jpeg,gif,png,bmp"}]},drop_element:this.picker,multipart_params:{strategy:this.container.dataset.strategy||"default"},init:this.getPluploadUploaderListeners(),container:this.container.querySelector("."+this.selectors.picker)},e||{});return new plupload.Uploader(t)},i.prototype.getPluploadUploaderListeners=function(){var e=this;return{FilesAdded:function(t,r){if(!e.multiple){var i=e.itemsContainer.querySelectorAll("."+e.selectors.item);Array.prototype.forEach.call(i,function(e){e.remove()})}e.checkReachMaxItemsLimit(),r=r.slice(0,e.maxItems-e.getItemsCount()),r.forEach(function(t){e.appendItemToContainer(e.createFileItem(t))}),t.start()},FileUploaded:function(t,r,i){var o=JSON.parse(i.response),s=e.renderItemContent(o);e.getFileItem(r).insertAdjacentHTML("beforeEnd",s),e.getFileItem(r).removeChild(e.getFileItem(r).querySelector("."+e.selectors.progress_bar))},UploadProgress:function(t,r){e.showItemProgress(r)},Error:function(t,r){e.showItemError(r)}}},t.a=i,window.Uploader=i},function(e,t,r){"use strict";var i=r(0);setTimeout(function(){if(document.querySelectorAll(".file-uploader").length){var e=document.querySelectorAll(".file-uploader");Array.prototype.forEach.call(e,function(e){var t=new i.a("#"+e.id);t.init()})}},100)}]);